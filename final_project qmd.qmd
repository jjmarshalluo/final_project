---
title: "final_project"
author: "Dodjivi Amekoudji, Emily Lang, Jessica Marshall, Kat Vrotsos"
format: html
editor: visual
imbed_resources: true
---

```{r}
# install.packages("here")
# install.packages("tidyverse")
library(here)
library(tidyverse)
library(ggplot2)
library(readr)
library(knitr)
```

# Load the data

```{r}
bmw_sales<- read_csv(here("data", "bmw_sales_data.csv"))
```

# Filter the data

```{r}
bmw_sales_decade <- bmw_sales %>% 
  filter(Year >= 2014)
```

# Top 3 popular models

```{r}
# rank BMW models by sales volume
# will use object bmw)decade_top3 for inline text describing top 3
bmw_decade_top3 <- bmw_sales_decade |> 
  group_by(Model) |> 
  summarize(Model_Sales = sum(Sales_Volume)) |> 
  arrange(desc(Model_Sales))
```

# Select relevant variables and filter data

```{r}
# only include top 3 bestselling models and relevant variables in dataset
bmw_sales_decade <- bmw_sales_decade |>
  filter(
    Model == '7 Series' |
    Model == '3 Series' |
    Model == 'i8'
  ) |>
  select(Model, Year, Region, Color, Fuel_Type, Price_USD, Sales_Volume)
```

# Top colors by year

```{r}
#| output: asis
# Table

# 1. Average Sales by Year and Color
avgsales <- bmw_sales_decade |> 
  group_by(Year, Color) |>
  summarize(mean_sales = mean(Sales_Volume), .groups = "drop") # Good use of .groups here and throughout to prevent future confusion down the line any time you use avgsales. I always forget this!

# 2. Summary Table (Long)
summary_table <- avgsales |>
  arrange(Year, Color)

summary_table

# 3. Formatted Table
kable(
  summary_table,
  col.names = c("Year", "Color", "Mean Sales Volume"), 
  caption = "Average BMW Sales by Color and Year"
)

# 4. Wide Table
summary_wide <- avgsales |>
  pivot_wider(
    names_from = Year,
    values_from = mean_sales
  )

summary_stats <- avgsales |>
  group_by(Color) |>
  summarize(
    avg_sales = mean(mean_sales),
    total_sales = sum(mean_sales),
    .groups = "drop"
  )

summary_stats
```

```{r}
# Figure

salescoloryear<- bmw_sales_decade |> 
  select(Color, Year, Sales_Volume)
avgsales<- salescoloryear |> 
  group_by(Year, Color) |>
  summarize(mean_sales = mean(Sales_Volume))

avgsales |>
ggplot(aes(Color,mean_sales)) +
geom_col(aes(fill = Color))+
  facet_wrap(~Year)+ # Separating out by year makes sense, though I personally wonder if there might be a way to have it on one larger graph with the x-axis as year, the y-axis as frequency, and each item contained within a group of vertical columns? Could be something to consider as right now, this feels very busy. It may also help to amend the labels so that we get a sense of the frequency of average sales.
  coord_flip()+
  scale_fill_manual(values = c("black", "blue", "grey", "red", "yellow", "white")) # This is clever! Coordinating the car color to the scale. Love it.
```

```{r}
# filter to 2014–2024, select needed variables

# bmw_price_sales <- bmw_sales %>%
# select(Year, Price_USD, Sales_Volume, Fuel_Type) %>%
# filter(Year >= 2014, Year <= 2024)

# Is the above section commented out because it was only done for a quick check? I don't see bmw_price_sales as a dataset anywhere else in the code; is this section still needed?

# summarize avg price and avg sales per year per fuel type

bmw_price_sales_summary <- bmw_sales_decade %>%
group_by(Year, Fuel_Type) %>%
summarize(
avg_price = mean(Price_USD, na.rm = TRUE),
avg_sales = mean(Sales_Volume, na.rm = TRUE)
)

# visualize relationship btw price and sales volume

ggplot(bmw_price_sales_summary, aes(x = avg_price, y = avg_sales)) + # Removed color = Fuel_Type as part of later-described test.
geom_line(linewidth = 1) +
geom_point(size = 2) +
  facet_wrap(~ Fuel_Type) # Added facet_wrap to test difference in visualization.
labs(
title = "Relationship Between BMW Price and Sales Volume (2014–2024)",
x = "Average Price",
y = "Average Sales Volume",
color = "Fuel Type"
) +
theme_minimal() # To me, this graph feels a bit chaotic. It tells me what it's meaning to tell me, but the overlapping in the lines sometimes makes it hard to follow. This could be an opportunity to try a facet_wrap() by fuel type. I amended the code above to sample it; it's not as colorful, but that can be fixed. I think this helps to cut down on the busy feeling of the original. Just a thought!


```

# Visualization Trends in BMW Model Price From 2014 to 2024 by Region

```{r}
bmw_sales_decade |>
  ggplot(aes(Year, Price_USD, color = Model)) +
  geom_smooth(se = FALSE) +
  labs(
    x = 'Year',
    y = 'Price (USD)',
    title = 'Trends in BMW Model Price From 2014 to 2024 by Region',
    subtitle = 'Top 3 Bestselling BMW Models'
  ) +
  facet_wrap(~Region)
```

We will use pivot_longer() to change data back to tidy version
